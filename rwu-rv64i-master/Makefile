
.ONESHELL:

asFile01 := readgpioid
asFile02 := allinstructions
asFile03 := filldmem
asFile04 := instr01loadbyte    # 4th test
asFile05 := instr02loadhalf    # 5th test
asFile06 := instr03loadword    # 6th test
asFile07 := instr19add
asFile08 := instr04loadbyteu   # 7th test
asFile09 := instr05loadhalfu   # 8th test
asFile10 := instr06addi        # third test
asFile11 := instr07slli        # second test
asFile29 := instr29lui         # first test

asmFiles := $(asFile29) \
	$(asFile11) \
	$(asFile10) \
	$(asFile04) \
	$(asFile05) \
	$(asFile06) \
	$(asFile08) \
	$(asFile09) \
	$(asFile01) \
	$(asFile02) \
	$(asFile03) \
	$(asFile07)

#asmFiles := $(asFile29)

.phony : doit
doit:
	$(foreach var,$(asmFiles), \
	echo $(var); \
	cp rv64Sim/$(var).asm rv64Sim/rv64i.asm; \
	cd rv64Sim && $(MAKE) all; \
	cd ..; \
	cp tb/tb_rv64i_$(var).sv tb/tb_rv64i.sv; \
	$(MAKE) -C sim; \
)

all: $(asmFiles)

$(asFile01): rv64Sim/$(asFile01).asm
	cp rv64Sim/$(asFile01).asm rv64Sim/rv64i.asm
	cd rv64Sim && $(MAKE) all
	cd ..
	cp tb/tb_rv64i_$(asFile01).sv tb/tb_rv64i.sv
	$(MAKE) -C sim

$(asFile02): rv64Sim/$(asFile02).asm
	cp rv64Sim/$(asFile02).asm rv64Sim/rv64i.asm
	cd rv64Sim && $(MAKE) all
	cd ..
	cp tb/tb_rv64i_$(asFile02).sv tb/tb_rv64i.sv
	$(MAKE) -C sim

$(asFile03): rv64Sim/$(asFile03).asm
	cp rv64Sim/$(asFile03).asm rv64Sim/rv64i.asm
	cd rv64Sim && $(MAKE) all
	cd ..
	cp tb/tb_rv64i_$(asFile03).sv tb/tb_rv64i.sv
	$(MAKE) -C sim

$(asFile04): rv64Sim/$(asFile04).asm
	cp rv64Sim/$(asFile04).asm rv64Sim/rv64i.asm
	cd rv64Sim && $(MAKE) all
	cd ..
	cp tb/tb_rv64i_$(asFile04).sv tb/tb_rv64i.sv
	$(MAKE) -C sim




simsv1:
	cp tb/tb_rv64i_allinstructions.sv tb/tb_rv64i.sv
	$(MAKE) -C sim

simsv2:
	cp tb/tb_rv64i_readgpioid.sv tb/tb_rv64i.sv
	$(MAKE) -C sim

compAsm1: rv64Sim/allinstructions.asm
	cp rv64Sim/allinstructions.asm rv64Sim/rv64i.asm
	cd rv64Sim && $(MAKE) all

compAsm2: rv64Sim/readgpioid.asm
	cp rv64Sim/readgpioid.asm rv64Sim/rv64i.asm
	cd rv64Sim && $(MAKE) all

.phony : clean
clean:
	@echo "Make clean"
	rm -f *.o
	rm -f *.s
	rm -f *.lst
	cd rv64Sim && $(MAKE) clean
	$(MAKE) clean -C ../sim
